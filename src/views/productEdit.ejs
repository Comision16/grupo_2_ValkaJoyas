<!DOCTYPE html>
<html lang="en">

<!-- CARRECEL Esto luego pasar a un .css correspondiente -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<%- include('partials/head', { title : 'EDITAR' }) %>

    <body style="background-color: lightblue;">
        <%- include('partials/header') %>
            <!-- BOOTSTRAP Edición de Productos Edicion Producto-->
            <div class="container" style="background-color: lightblue;">
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title font-weight-bold">Edición de Productos</h5>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-10 mx-auto">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title font-weight-bold">Edición Producto</h5>
                            <form class="form-inline">
                                <div class="form-group mr-2">
                                    <label for="inputBusqueda"><em><strong> Busqueda del Producto:</strong></em></label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="inputBusqueda"
                                            placeholder="Ingrese titulo del producto">
                                    </div>

                                    <div class="d-flex justify-content-center">
                                        <button type="submit" class="btn btn-primary">Buscar</button>
                                    </div>
                                </div>
                            </form>

                            <form action="/products/update/<%= product.id %>?_method=PUT" method="POST" enctype="multipart/form-data" >
                    
                                                                          
                                <label>
                                    <h5><strong>DATOS</strong></h5>
                                </label><br>
                                <div class="form-row">
                                    <div class="form-group col-md-3">
                                        <label for="referencia" class="col-form-label"><strong>Referencia: </strong></label> 
                                        <br>    
                                        <div class="d-flex justify-content-center">
                                        <span class="bg-warning" style="font-size: 1.5em;">  
                                           <%= product.id %>
                                            </span>
                                        </div>
                                        <!-- <input type="text" placeholder="number" id="referencia" -->
                                        <!-- name="referencia" class="form-control" required> -->
                                    </div>
                                    <div class="form-group col-md-9">
                                        <label for="formName" class="col-form-label"><strong>Nombre:</strong></label>
                                        <input type="text" placeholder="Nombre / Título" minlength="3" maxlength="25" id="name" name="name"
                                            class="form-control"
                                            value="<%= locals.old && locals.old.name ? locals.old.name : product.name %>"
                                            >
                                            <small id="msg-name" class="ms-2 text-danger">
                                                <%= locals.errors && (errors.name && errors.name.msg) %>
                                            </small>
                                    </div>
                                </div>
                                

                                <div class="form-group">
                                    <label for="description"><strong>Descripción:</strong></label>
                                    <textarea placeholder="Detalle del producto" id="description" name="description"
                                        class="form-control"
                                        style="resize: none;"><%= locals.old && locals.old.description ? locals.old.description : product.description %></textarea>
                                        <small id="msg-description" class="ms-2 text-danger">
                                            <%= locals.errors && (errors.description && errors.description.msg) %>
                                        </small>
                                </div>

                                <div class="form-row">
                                    <div class="form-group col-md">
                                        <label for="brand" class="d-block text-center"><strong>Marca:</strong></label>
                                        <span class="d-block text-center"><%= product.brandId %></span>
                                    </div>
                                    
                                    <div class="form-group col-md">
                                        <label for="model" class="d-block text-center"><strong>Modelo:</strong></label>
                                        <span class="d-block text-center"><%= product.designId %></span>
                                    </div>
                                    
                                    <div class="form-group col-md">
                                        <label for="collection" class="d-block text-center"><strong>Colección:</strong></label>
                                        <input type="text" minlength="3" maxlength="25" id="collection" name="collection" 
                                            class="form-control text-center"
                                            value="<%= locals.old && locals.old.collection ? locals.old.collection : product.collectionId %>"
                                        >
                                        <small id="msg-collection" class="ms-2 text-danger">
                                            <%= locals.errors && (errors.collection && errors.collection.msg) %>
                                        </small>
                                    </div>
                                </div>
                                    
                                <label>
                                    <h5><strong>IMÁGENES</strong></h5>
                                </label><br>
                                <div class="form-group row row ml-2 mr-2">
                                    <label for="image1" class="col-md-4 btn btn-secondary d-flex align-items-center justify-content-center">Principal:</label>
                                    <div class="col-md-4">
                                        <input hidden class="form-control" type="file" id="image1" name="image1" accept="image/*">
                                        
                                        <% if (locals.errors && errors.image1) { %>
                                            <!-- Muestra el mensaje de error si existe un error para 'image1' -->
                                            <small id="msg-image1" class="ms-2 text-danger">
                                                <%= errors.image1.msg %>
                                            </small>
                                        <% } else { %>
                                            <!-- Muestra la imagen actual cargada desde la base de datos -->
                                            <div class="col-12 col-md-4">
                                                <img src="/images/<%= product.image1 %>" class="img-fluid" alt="<%= product.image1 %>">
                                            </div>
                                        <% } %>
                                    </div>
                                </div>

                            <div>
                                <div class="form-group row ml-2 mr-2"> <!-- Contenedor de CARGA de 2da imagen -->
                                <label for="image2" class="col-md-4 btn btn-primary d-flex align-items-center justify-content-center">Secundarias:</label>
                                <div class="col-md-4">
                                  <input hidden class="form-control" type="file" id="image2" name="image2" accept="image/*" multiple>
                                
                
                                <div class="form-group row d-md-none">  <!-- Esto ocultará el carrusel en pantallas más grandes -->
                                      <div id="imageCarousel" class="carousel slide" data-ride="carousel">
                                        <div class="carousel-inner">
                                          <!-- CODIGO DE FUNCION FORECHER PARA IMAGE2 como es ARRAY la debo descomprimir -->
                                        </div>
                                        <a class="carousel-control-prev" href="#imageCarousel" role="button" data-slide="prev">
                                          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                          <span class="sr-only">Previous</span>
                                        </a>
                                        <a class="carousel-control-next" href="#imageCarousel" role="button" data-slide="next">
                                          <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                          <span class="sr-only">Next</span>
                                        </a>
                                      </div>
                                </div>

                                <div class="form-group row d-none d-md-block"> <!-- Esto ocultará el formulario en pantallas moviles -->
                                      <div class="col-12 col-md-6">
                                        <div class="d-flex">
         <!-- CODIGO DE FUNCION FORECHER PARA IMAGE2 como es ARRAY la debo descomprimir -->
                                        </div>
                                      </div>
                                </div>
                            </div>
                        </div>
                             </div>
                                <label>
                                    <h5><strong>CLASIFICACIÓN</strong></h5>
                                </label><br>
                                <label for="category"><strong>Categoría:</strong></label>
                                <div class="row align-items-center">
                                    <% if (product.categoryId == '1') { %>
                                        <div class="col-8 col-md-6 col-lg-4 d-flex align-items-center">
                                            <label for="anillos">
                                                <p><strong>Elección:</strong> Anillos </p>
                                            </label>
                                        </div>
                                    <% } else if (product.categoryId == '2') { %>
                                        <div class="col-8 col-md-6 col-lg-4 d-flex align-items-center">
                                            <label for="collares">
                                                <p><strong>Elección:</strong> Collar </p>
                                            </label>
                                        </div>
                                    <% } else if (product.categoryId == '3') { %>
                                        <div class="col-8 col-md-6 col-lg-4 d-flex align-items-center">
                                            <label for="pulseras">
                                                <p><strong>Elección:</strong> Pulseras </p> 
                                            </label>
                                        </div>
                                    <% } else if (product.categoryId == '4') { %>
                                        <div class="col-8 col-md-6 col-lg-4 d-flex align-items-center">
                                            <label for="pendientes">
                                                <p><strong>Elección:</strong> Pendientes </p>
                                            </label>
                                        </div>
                                    <% } else if (product.categoryId == '5') { %>
                                        <div class="col-8 col-md-6 col-lg-4 d-flex align-items-center">
                                            <label for="accesorios">
                                                <p><strong>Elección:</strong> Accesorios </p>
                                            </label>
                                        </div>
                                    <% } %>
                                </div>

                                <!-- Articulo -->
                                <div>
                                    <div>

                                        <div class="col-9 mb-6">
                                            <label for="metal"><strong>Metal:</strong></label>
                                            <p><strong>Elección:</strong> <%= getMetalName(product.metalId) %></p>
                                        </div>
                                        
                                        <% function getMetalName(metalId) {
                                            switch (metalId) {
                                                case 1: return "Oro 18K (750)";
                                                case 2: return "Oro 14K (585)";
                                                case 3: return "Oro 24K (999)";
                                                case 4: return "Oro Blanco 18K (750)";
                                                case 5: return "Oro Blanco 14K (585)";
                                                case 6: return "Oro Amarillo 22K (916)";
                                                case 7: return "Oro Amarillo 21K (875)";
                                                case 8: return "Oro Amarillo 20K (833)";
                                                case 9: return "Oro Verde";
                                                case 10: return "Oro Rosa 10K";
                                                case 11: return "Oro Rosa 14K";
                                                case 12: return "Plata 925 (92.5% de pureza)";
                                                case 13: return "Plata de Ley (92.5% de pureza)";
                                                case 14: return "Plata Fina (95-99.9% de pureza)";
                                                case 15: return "Platino 950 (95% de pureza)";
                                                case 16: return "Platino 850 (85% de pureza)";
                                                case 17: return "Paladio 950 (95% de pureza)";
                                                case 18: return "Rodio";
                                                case 19: return "Bronce";
                                                case 20: return "Cobre";
                                                case 21: return "Zinc";
                                                case 22: return "Acero Quirúrgico";
                                                case 23: return "Titanio Grado 5";
                                                case 24: return "Titanio Grado 7";
                                                case 25: return "Titanio Puro grado 1-4";
                                                case 26: return "Otro";
                                                default: return "Seleccione una opción";
                                            }
                                        } %>
                                        

                                        <div class="col-3 mb-4">
                                            <label for="stones"><strong>N° de Piedras:</strong></label>
                                            <input type="number" id="stones" name="stones" 
                                            class="form-control"
                                                value="<%= locals.old && locals.old.stones ? locals.old.stones : product.stones %>"
                                                >
                                            <small id="msg-stones" class="ms-2 text-danger">
                                                <%= locals.errors && (errors.stones && errors.stones.msg) %>
                                            </small>
                                        </div>
                                    </div>
                                </div>
                                <label>
                                    <h5><strong>DETALLE</strong></h5>
                                </label><br>

                                <label><strong>Tipo de Piedra:</strong></label><br>
                                <div class="table-responsive">
                                    <div class="d-flex flex-wrap">
                                        <!-- Opciones de checkbox -->
                                        <div class="col-6 col-md-4 col-lg-2 mb-2 checkbox-cell">

                                            <label for="otro_piedra">
                                                <input type="checkbox" id="Otro" name="type_stone"  value="<%= product.type_stone %>"        >
                                                    <!-- BORRE 3 lineas includes no corresponde a funcion -->
                                                
                                              Otro
                                            </label>

                                        </div>
                                        <div class="col-6 col-md-4 col-lg-2 mb-2 checkbox-cell">

                                            <label for="topacio">
                                                <input type="checkbox" id="Topacio" name="type_stone"  value="<%= product.type_stone %>" >
                                                    <!-- BORRE 3 lineas includes no corresponde a funcion -->
                                                
                                              Topacio
                                            </label>

                                        </div>
                                        <div class="col-6 col-md-4 col-lg-2 mb-2 checkbox-cell">

                                            <label for="cuarzo">
                                                <input type="checkbox" id="Cuarzo" name="type_stone"  value="<%= product.type_stone %>"     >
                                                    <!-- BORRE 3 lineas includes no corresponde a funcion -->
                                                
                                              Cuarzo
                                            </label>

                                        </div>
                                        <div class="col-6 col-md-4 col-lg-2 mb-2 checkbox-cell">

                                            <label for="diamantes">
                                                <input type="checkbox" id="Diamantes" name="type_stone"  value="<%= product.type_stone %>"    >
                                                    <!-- BORRE 3 lineas includes no corresponde a funcion -->
                                                
                                              Diamantes
                                            </label>
                                            
                                        </div>
                                        <div class="col-6 col-md-4 col-lg-2 mb-2 checkbox-cell">

                                            <label for="rubies">
                                                <input type="checkbox" id="Rubíes" name="type_stone"  value="<%= product.type_stone %>"    >
                                                    <!-- BORRE 3 lineas includes no corresponde a funcion -->
                                                
                                              Rubíes
                                            </label>

                                        </div>
                                        <div class="col-6 col-md-4 col-lg-2 mb-2 checkbox-cell">

                                            <label for="zafiros">
                                                <input type="checkbox" id="Zafiros" name="type_stone"  value="<%= product.type_stone %>"       >
                                                    <!-- BORRE 3 lineas includes no corresponde a funcion -->
                                                
                                              Zafiros
                                            </label>

                                        </div>
                                        <div class="col-6 col-md-4 col-lg-2 mb-2 checkbox-cell">

                                            <label for="esmeraldas">
                                                <input type="checkbox" id="Esmeraldas" name="type_stone"  value="<%= product.type_stone %>"     >
                                                    <!-- BORRE 3 lineas includes no corresponde a funcion -->
                                                
                                              Esmeraldas
                                            </label>

                                        </div>
                                        <div class="col-6 col-md-4 col-lg-2 mb-2 checkbox-cell">

                                            <label for="jade">
                                                <input type="checkbox" id="Jade" name="type_stone"  value="<%= product.type_stone %>"        >
                                                    <!-- BORRE 3 lineas includes no corresponde a funcion -->
                                                
                                              Jade
                                            </label>

                                        </div>
                                        <div class="col-6 col-md-4 col-lg-2 mb-2 checkbox-cell">
                                           
                                            <label for="amatista">
                                                <input type="checkbox" id="Amatista" name="type_stone"  value="<%= product.type_stone %>"      >
                                                    <!-- BORRE 3 lineas includes no corresponde a funcion -->
                                                
                                              Amatista
                                            </label>

                                        </div>
                                        <div class="col-6 col-md-4 col-lg-2 mb-2 checkbox-cell">

                                            <label for="opal">
                                                <input type="checkbox" id="Ópalo" name="type_stone"  value="<%= product.type_stone %>"      >
                                                    <!-- BORRE 3 lineas includes no corresponde a funcion -->
                                                
                                              Ópalo
                                            </label>

                                        </div>
                                        <div class="col-6 col-md-4 col-lg-2 mb-2 checkbox-cell">

                                            <label for="coral">
                                                <input type="checkbox" id="Coral" name="type_stone"  value="<%= product.type_stone %>"        >
                                                    <!-- BORRE 3 lineas includes no corresponde a funcion -->
                                                
                                              Coral
                                            </label>

                                        </div>
                                        <div class="col-6 col-md-4 col-lg-2 mb-2 checkbox-cell">

                                            <label for="perlas">
                                                <input type="checkbox" id="Perlas" name="type_stone"  value="<%= product.type_stone %>"       >
                                                    <!-- BORRE 3 lineas includes no corresponde a funcion -->
                                                
                                              Perlas
                                            </label>

                                        </div>
                                    </div>
                                </div>

                                 <!-- <label><strong>Color Producto:</strong></label><br>
                                <div class="d-flex flex-wrap"> -->
                                    
                                    <!-- BORRE COLOR PRODUCTO -->

                                <!-- </div> -->

                                <div class="row justify-content-between">
                                    <div class="col-12 col-md-8">
                                        <div class="row">
                                            <div class="col-7 col-md-8">
                                                <label for="size"><strong>Tamaño:</strong></label>
                                                <input type="text" placeholder="Codigo alfanumerico" id="size" name="size" 
                                                class="form-control" 
                                                value="<%= locals.old && locals.old.size ? locals.old.size : product.size %>"
                                                >
                                                <small id="msg-size" class="ms-2 text-danger">
                                                    <%= locals.errors && (errors.size && errors.size.msg) %>
                                                </small>
                                            </div>
                                            <div class="col-5 col-md-4">
                                                <label for="measures_mm"><strong>Medida (mm):</strong></label>
                                                <input type="number" placeholder="en numeros de mm" id="measures_mm" name="measures_mm" 
                                                class="form-control" 
                                                value="<%= locals.old && locals.old.measures_mm ? locals.old.measures_mm : product.measures_mm %>"
                                                >
                                                <small id="msg-measures_mm" class="ms-2 text-danger">
                                                    <%= locals.errors && (errors.measures_mm && errors.measures_mm.msg) %>
                                                </small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Garantia -->
                                <div class="row justify-content-center">
                                    <div class="col-12 col-md-8">
                                        <div class="row">
                                            <div class="col-6">
                                                <strong> Garantía:</strong><br>
                                                <div>
                                                <label class="form-check-label ml-4 mr-4" for="si_warranty"><strong> Si </strong></label>
                                                    <input type="radio" id="si_warranty" name="warranty"
                                                    class="form-check-input" 
                                                    value="true"   <%= (locals.old && old.warranty === 'true') || (product.warranty == '1') ? 'checked' : '' %>
                                                    >
                                                    <small id="msg-warranty1" class="d-block ms-2 text-danger">
                                                        <%= locals.errors && (errors.warranty && errors.warranty.msg) %>
                                                     </small>
                                                    </div>
                                                    <div>
                                                <label class="form-check-label ml-4 mr-4" for="no_warranty"><strong> No </strong></label>
                                                    <input type="radio" id="no_warranty" name="warranty"
                                                    class="form-check-input"
                                                    value="false" <%= (locals.old && old.warranty === 'false') || (product.warranty == '0') ? 'checked' : '' %>
                                                    >
                                                    <small id="msg-warranty2" class="d-block ms-2 text-danger">
                                                        <%= locals.errors && (errors.warranty && errors.warranty.msg) %>
                                                    </small>
                                                </div>
                                            </div>
                                
                                            <div class="col-6">
                                                <strong>Guardajoyas:</strong> <br>
                                                <div>
                                                    <label class="form-check-label ml-4 mr-4" for="si_jewel_keeper"><strong> Si </strong></label>
                                                    <input type="radio" id="si_jewel_keeper" name="jewel_keeper"
                                                    class="form-check-input"
                                                    value="true" <%= (locals.old && old.jewel_keeper === 'true') || (product.jewel_keeper == '1') ? 'checked' : '' %>
                                                    >
                                                    <small id="msg-jewel_keeper1" class="d-block ms-2 text-danger">
                                                        <%= locals.errors && (errors.jewel_keeper && errors.jewel_keeper.msg) %>
                                                     </small>
                                                </div>
                                                <div>
                                                <label class="form-check-label ml-4 mr-4" for="no_jewel_keeper"><strong> No </strong></label>
                                                    <input type="radio" id="no_jewel_keeper" name="jewel_keeper"
                                                    class="form-check-input"
                                                    value="false" <%= (locals.old && old.jewel_keeper === 'false') || (product.jewel_keeper == '0') ? 'checked' : '' %>
                                                    >
                                                    <small id="msg-jewel_keeper2" class="d-block ms-2 text-danger">
                                                        <%= locals.errors && (errors.jewel_keeper && errors.jewel_keeper.msg) %>
                                                    </small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <label>
                                    <h5><strong>ECONOMÍA</strong></h5>
                                </label><br>
                                <div class="row justify-content-between">
                                    <div class="col-12 col-md-8">
                                        <div class="row justify-content-between">
                                            <!-- Campo de Precio Original -->
                                            <div class="col-12 col-md-5 mb-2 text-center">
                                                <label for="price"><strong>Precio Original:</strong></label>
                                                <input type="number" id="price" name="price" 
                                                class="form-control" 
                                                value="<%= locals.old && locals.old.price ? locals.old.price : product.price %>"
                                                >
                                                <small id="msg-price" class="ms-2 text-danger">
                                                    <%= locals.errors && (errors.price && errors.price.msg) %>
                                                </small>
                                            </div>
                                            <!-- Campo de Descuento % -->
                                            <div class="col-12 col-md-2 mb-2 text-center">
                                                <label for="discount"><strong>Oferta_%:</strong></label>
                                                <input type="number" id="discount" name="discount" 
                                                class="form-control" 
                                                value="<%= locals.old && locals.old.discount ? locals.old.discount : product.discount %>"
                                                >
                                                <small id="msg-discount" class="ms-2 text-danger">
                                                    <%= locals.errors && (errors.discount && errors.discount.msg) %>
                                                </small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row justify-content-start">
                                    <div class="col-12 col-md-6">
                                        <div class="form-group mb-2 text-center">
                                            <label for="stock" class="col-form-label mr-2"><strong>Stock:</strong></label>
                                            <input type="number" id="stock" name="stock" 
                                            class="form-control"
                                            value="<%= locals.old && locals.old.stock ? locals.old.stock : product.stock %>"
                                            >
                                            <small id="msg-stock" class="ms-2 text-danger">
                                                <%= locals.errors && (errors.stock && errors.stock.msg) %>
                                            </small>
                                        </div>
                                    </div>
                                </div>
                                
                                    <!-- Otros elementos del formulario aquí -->
                                
                                    <input type="hidden" name="editStone" id="valoresEditStone">
                                
                                    <button type="submit" id="edicion" class="btn btn-dark">Actualizar</button>
                                </form>
                                
                            <!-- EXPLICACION: vaciar el array de type_stone (del json o BD) cuando se apreta el boton actualizar, luego recorre los checkout 
                                y los carga en el arrat vacio  (UNICAMENTE Ocurre esto si se apreta el boton actualizar)  -->

                                <script>
                                    
                                    let botonActualizar = document.querySelector('button#edicion');
                                    botonActualizar.addEventListener("click", function() {
                                        let checkboxes = document.querySelectorAll('input[type="checkbox"]'); // Obtener todas las casillas de verificación
                            
                                        let type_stone = []; // Crear un nuevo array para almacenar los valores
                            
                                        checkboxes.forEach(function(checkbox) {
                                            if (checkbox.checked) { // Verificar si el checkbox está marcado
                                                type_stone.push(checkbox.id);
                                            }
                                        });

                                        let editStone = JSON.stringify(type_stone);

                                        // Actualizar el valor del campo oculto en el formulario con los valoresTexto
                                        document.getElementById('valoresEditStone').value = editStone;
                                    
                                    });
                                </script>
                            



                            <style>
                                .checkbox-cell {
                                    cursor: pointer;
                                    transition: background-color 0.3s ease-in-out;
                                }

                                .checkbox-cell:hover {
                                    background-color: gold;
                                }

                                .small-input {
                                    width: 70px;
                                    justify-content: center;
                                    text-align: center;
                                    align-items: center;
                                    margin-left: 20px
                                }
                            </style>
                        </div>
                    </div>
                </div>
            </div>
    </body>

</html>